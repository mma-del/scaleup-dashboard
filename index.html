<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scaleup Finance - Complete Project Dashboard</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', sans-serif; background: #f5f7fa; color: #333; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        
        /* Login Screen */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #3a4a47 0%, #2d3a36 100%);
        }
        
        .login-box {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 400px;
        }
        
        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .login-logo h1 {
            font-size: 2.5em;
            background: linear-gradient(135deg, #3a4a47, #2d3a36);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .auth-form input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
        }
        
        .auth-form button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #3a4a47, #2d3a36);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .auth-form button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(58, 74, 71, 0.3);
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            display: none;
        }
        
        /* User Bar */
        .user-bar {
            background: white;
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-email {
            font-weight: 600;
            color: #3a4a47;
        }
        
        /* Header */
        .header { 
            background: linear-gradient(135deg, #3a4a47 0%, #2d3a36 100%);
            color: white; 
            padding: 50px; 
            border-radius: 15px; 
            margin-bottom: 30px; 
            text-align: center;
        }
        
        .header-content {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            gap: 30px;
        }
        
        .scaleup-logo {
            width: 100px; 
            height: 100px; 
            background: #ffffff; 
            border-radius: 15px; 
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .scaleup-logo img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 10px;
        }
        
        .logo-fallback {
            color: #3a4a47; 
            font-size: 48px; 
            font-weight: 800;
        }
        
        .company-name {
            font-size: 4em;
            font-weight: 700;
            color: white;
        }
        
        /* Navigation */
        .nav-tabs { 
            display: flex; 
            background: white; 
            border-radius: 12px; 
            overflow: hidden; 
            margin-bottom: 30px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.08); 
        }
        
        .nav-tab { 
            flex: 1; 
            padding: 15px 25px; 
            background: #f8f9fa; 
            border: none; 
            cursor: pointer; 
            font-size: 1.1em; 
            font-weight: 600; 
            transition: all 0.3s; 
        }
        
        .nav-tab.active { 
            background: linear-gradient(135deg, #3a4a47, #2d3a36); 
            color: white; 
        }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        /* Forms */
        .setup-form { 
            background: white; 
            padding: 30px; 
            border-radius: 12px; 
            margin-bottom: 20px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.08); 
        }
        
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label { 
            display: block; 
            font-weight: 600; 
            margin-bottom: 8px; 
            color: #495057; 
        }
        
        .form-group input, .form-group textarea { 
            width: 100%; 
            padding: 12px; 
            border: 2px solid #dee2e6; 
            border-radius: 8px; 
            font-size: 1em; 
            font-family: 'Segoe UI', sans-serif; 
        }
        
        /* Logo Upload Area */
        .logo-upload-area {
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .logo-upload-area:hover {
            border-color: #3a4a47;
            background: #e9ecef;
        }
        
        .logo-preview {
            margin-top: 15px;
            display: none;
        }
        
        .logo-preview img {
            max-width: 150px;
            max-height: 150px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        /* Buttons */
        .btn { 
            padding: 12px 25px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 1em; 
            margin: 5px; 
            transition: all 0.3s; 
        }
        
        .btn-primary { background: #3a4a47; color: white; }
        .btn-primary:hover { background: #2d3a36; transform: translateY(-2px); }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        
        /* Team Members Section */
        .team-section {
            background: #f8f9fa; 
            padding: 20px; 
            border-radius: 8px; 
            margin: 20px 0;
            border: 2px solid #3a4a47;
        }
        
        .team-section h3 {
            color: #3a4a47; 
            margin-bottom: 15px;
        }
        
        .team-input-row {
            display: flex; 
            gap: 10px; 
            margin-bottom: 15px;
            align-items: center;
        }
        
        .team-input {
            flex: 1; 
            padding: 10px; 
            border: 1px solid #ddd; 
            border-radius: 4px;
            font-size: 1em;
        }
        
        .team-select {
            padding: 10px; 
            border: 1px solid #ddd; 
            border-radius: 4px;
            background: white;
            min-width: 150px;
        }
        
        .team-member-item {
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 12px 15px; 
            background: white; 
            border-radius: 6px; 
            margin: 8px 0; 
            border: 1px solid #ddd;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* Dashboard KPIs */
        .dashboard-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
            gap: 25px; 
            margin-bottom: 40px; 
        }
        
        .kpi-card { 
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            padding: 30px; 
            border-radius: 20px; 
            box-shadow: 0 10px 30px rgba(58, 74, 71, 0.15); 
            text-align: center; 
            transition: all 0.4s;
            border: 1px solid rgba(58, 74, 71, 0.1);
        }
        
        .kpi-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(58, 74, 71, 0.2);
        }
        
        .kpi-icon {
            width: 60px;
            height: 60px;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, #3a4a47, #2d3a36);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }
        
        .kpi-value { 
            font-size: 3.5em; 
            font-weight: 800; 
            margin: 20px 0 10px; 
            background: linear-gradient(135deg, #3a4a47, #2d3a36);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .kpi-label { 
            color: #666; 
            font-size: 1.1em; 
            font-weight: 600;
            text-transform: uppercase; 
            letter-spacing: 1px; 
            margin-bottom: 15px;
        }
        
        .progress-bar { 
            width: 100%; 
            height: 8px; 
            background: #e9ecef; 
            border-radius: 10px; 
            overflow: hidden; 
            margin: 20px 0 10px;
        }
        
        .progress-fill { 
            height: 100%; 
            background: linear-gradient(90deg, #3a4a47, #2d3a36); 
            border-radius: 10px; 
            transition: width 1s;
        }
        
        /* Team Performance Dashboard */
        .team-distribution { 
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            padding: 35px; 
            border-radius: 20px; 
            box-shadow: 0 10px 30px rgba(58, 74, 71, 0.15);
            border: 1px solid rgba(58, 74, 71, 0.1);
            margin-top: 30px;
        }
        
        .team-distribution h3 { 
            color: #3a4a47; 
            margin-bottom: 30px; 
            text-align: center;
            font-size: 1.6em;
            font-weight: 700;
        }
        
        .person-task-row { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 20px 25px; 
            border-bottom: 1px solid rgba(58, 74, 71, 0.1);
            transition: all 0.3s;
            border-radius: 10px;
            margin: 0 -10px;
        }
        
        .person-task-row:hover {
            background: rgba(58, 74, 71, 0.05);
            transform: translateX(5px);
        }
        
        .person-name { 
            font-weight: 700; 
            color: #3a4a47; 
            font-size: 1.1em;
        }
        
        .task-counts { 
            display: flex; 
            gap: 20px; 
            align-items: center;
        }
        
        .task-count { 
            font-size: 0.95em; 
            font-weight: 600;
            padding: 8px 16px;
            border-radius: 20px;
        }
        
        .count-completed { 
            color: #28a745; 
            background: rgba(40, 167, 69, 0.1);
            border: 1px solid rgba(40, 167, 69, 0.2);
        }
        
        .count-progress { 
            color: #3a4a47; 
            background: rgba(58, 74, 71, 0.1);
            border: 1px solid rgba(58, 74, 71, 0.2);
        }
        
        .count-total { 
            color: #666;
            background: rgba(102, 102, 102, 0.1);
            border: 1px solid rgba(102, 102, 102, 0.2);
        }
        
        /* Project Table */
        table { 
            width: 100%; 
            border-collapse: collapse; 
            background: white; 
            border-radius: 12px; 
            overflow: hidden; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.08); 
        }
        
        th, td { 
            padding: 15px; 
            text-align: left; 
            border-bottom: 1px solid #dee2e6; 
        }
        
        th { 
            background: #f8f9fa; 
            font-weight: 600; 
            color: #495057; 
        }
        
        .table-header { 
            background: #3a4a47; 
            color: white; 
            padding: 20px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        
        /* Task Row Styling */
        .task-cell {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }
        
        .task-name {
            flex: 1;
        }
        
        /* Subtask Styles */
        .subtask-input-area {
            background: #fff3cd; 
            border: 2px solid #3a4a47; 
            border-radius: 8px; 
            padding: 20px; 
            margin: 15px 0; 
            display: none;
        }
        
        .subtask-input { 
            width: 100%; 
            padding: 10px; 
            margin: 10px 0; 
            border: 1px solid #ddd; 
            border-radius: 4px; 
        }
        
        .subtask-row { 
            background-color: #f8f9fa; 
            border-left: 4px solid #3a4a47; 
        }
        
        .subtask-row td { 
            padding-left: 35px; 
            font-size: 0.95em; 
        }
        
        .add-subtask-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 6px 14px;
            border-radius: 5px;
            font-size: 0.85em;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .add-subtask-btn:hover {
            background: #218838;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.15);
        }
        
        /* Status Select */
        .status-select { 
            padding: 8px 12px; 
            border: none; 
            border-radius: 6px; 
            background: white; 
            cursor: pointer; 
            font-weight: 600; 
        }
        
        .status-completed { background: #28a745; color: white; }
        .status-in-progress { background: #3a4a47; color: white; }
        .status-not-started { background: #e9ecef; color: #495057; }
        
        .warning-message { 
            background: #fff3cd; 
            border: 1px solid #ffeaa7; 
            color: #856404; 
            padding: 15px; 
            border-radius: 8px; 
            margin-bottom: 20px; 
        }
        
        /* Configuration Panel */
        .config-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            width: 300px;
            display: none;
            z-index: 1000;
        }
        
        .config-panel h3 {
            margin-bottom: 15px;
            color: #3a4a47;
        }
        
        .config-input {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9em;
        }
        
        .config-toggle {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #3a4a47;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            z-index: 999;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="login-screen" class="login-container" style="display: none;">
        <div class="login-box">
            <div class="login-logo">
                <h1>Scaleup Finance</h1>
                <p>Project Management Dashboard</p>
            </div>
            
            <div id="error-message" class="error-message"></div>
            
            <div class="auth-form">
                <h2 style="margin-bottom: 20px;">Login</h2>
                <input type="email" id="login-email" placeholder="Email">
                <input type="password" id="login-password" placeholder="Password">
                <button onclick="handleLogin()">Log In</button>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="main-dashboard" class="container">
        
        <!-- User Bar -->
        <div class="user-bar">
            <div class="user-info">
                <span>Logged in as:</span>
                <span class="user-email" id="current-user-email">demo@scaleup.dk</span>
            </div>
            <button class="btn btn-danger" onclick="handleLogout()">Log Out</button>
        </div>
        
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div class="scaleup-logo">
                    <img id="header-logo" style="display: none;" alt="Company Logo">
                    <div class="logo-fallback" id="logo-fallback">8</div>
                </div>
                <div class="company-name">Scaleup Finance</div>
            </div>
            <div class="header-description">e-conomic Dimensions Implementation Dashboard</div>
        </div>

        <!-- Navigation -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('setup')">🔧 Client Setup</button>
            <button class="nav-tab" onclick="switchTab('dashboard')">📊 Dashboard</button>
            <button class="nav-tab" onclick="switchTab('project')">📋 Project Plan</button>
        </div>

        <!-- Client Setup Tab -->
        <div id="setup-tab" class="tab-content active">
            <div class="setup-form">
                <h2>Client Information Setup</h2>
                <p style="margin-bottom: 25px; color: #666;">Configure client details for this project.</p>
                
                <div class="form-group">
                    <label>Client Company Name *</label>
                    <input type="text" id="client-name" placeholder="e.g., ABC Corporation">
                </div>
                
                <div class="form-group">
                    <label>Upload Company Logo</label>
                    <div class="logo-upload-area" onclick="document.getElementById('logo-upload').click()">
                        <input type="file" id="logo-upload" accept="image/*" style="display: none;" onchange="handleLogoUpload(event)">
                        <p style="color: #666;">📷 Click to upload logo (PNG, JPG, GIF)</p>
                        <div class="logo-preview" id="logo-preview">
                            <img id="preview-image" alt="Logo preview">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Scaleup Finance Project Manager *</label>
                    <input type="text" id="scaleup-pm" placeholder="e.g., Lars Jensen">
                </div>
                
                <div class="form-group">
                    <label>Client Project Manager</label>
                    <input type="text" id="client-pm" placeholder="e.g., John Smith (CFO)">
                </div>
                
                <!-- Team Members Section -->
                <div class="team-section">
                    <h3>👥 Team Members</h3>
                    <p style="color: #666; margin-bottom: 15px; font-size: 0.9em;">
                        Add team members who can be assigned to specific tasks
                    </p>
                    
                    <div class="team-input-row">
                        <input type="text" id="new-member-name" class="team-input" placeholder="Enter team member name...">
                        <select id="new-member-company" class="team-select">
                            <option value="Scaleup Finance">Scaleup Finance</option>
                            <option value="Client">Client</option>
                        </select>
                        <button class="btn btn-success" onclick="addTeamMember()">➕ Add Member</button>
                    </div>

                    <div id="team-members-list">
                        <p style="color: #666; font-style: italic; text-align: center; padding: 20px;">
                            No team members added yet
                        </p>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Project Notes (Optional)</label>
                    <textarea id="project-notes" rows="3" placeholder="Any specific notes..."></textarea>
                </div>
                
                <button class="btn btn-primary" onclick="saveSetup()">💾 Save Client Setup</button>
                <button class="btn btn-secondary" onclick="fillTestData()">🧪 Fill Test Data</button>
            </div>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard-tab" class="tab-content">
            <div id="dashboard-warning" class="warning-message">
                ⚠️ Please complete the Client Setup first to view the dashboard.
            </div>
            
            <div id="dashboard-content" style="display: none;">
                <div class="dashboard-grid">
                    <div class="kpi-card">
                        <div class="kpi-icon">📈</div>
                        <div class="kpi-label">Overall Progress</div>
                        <div class="kpi-value" id="overall-progress">0%</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="overall-progress-bar" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-icon">✅</div>
                        <div class="kpi-label">Completed Tasks</div>
                        <div class="kpi-value" id="completed-tasks">0</div>
                        <div style="color: #666;">of <span id="total-tasks">0</span> total</div>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-icon">🔄</div>
                        <div class="kpi-label">Active Tasks</div>
                        <div class="kpi-value" id="ongoing-tasks">0</div>
                        <div style="color: #666;">in progress</div>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-icon">🎯</div>
                        <div class="kpi-label">Next Milestone</div>
                        <div class="kpi-value" style="font-size: 1.5em;" id="next-milestone">Requirements</div>
                    </div>
                </div>
                
                <!-- Team Performance Dashboard -->
                <div class="team-distribution">
                    <h3>👥 Team Performance Dashboard</h3>
                    <div id="team-task-distribution">
                        <!-- Will be populated dynamically -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Project Plan Tab -->
        <div id="project-tab" class="tab-content">
            <div id="project-warning" class="warning-message">
                ⚠️ Please complete the Client Setup first to access the project plan.
            </div>
            
            <div id="project-content" style="display: none;">
                <!-- Subtask Input Area -->
                <div id="subtask-input-area" class="subtask-input-area">
                    <h4>✏️ Create New Subtask</h4>
                    <p><strong>Adding to:</strong> <span id="target-task">Unknown Task</span></p>
                    <input type="text" id="subtask-name" class="subtask-input" placeholder="Enter subtask name...">
                    <input type="text" id="subtask-desc" class="subtask-input" placeholder="Optional description...">
                    <button class="btn btn-success" onclick="createSubtask()">➕ Create Subtask</button>
                    <button class="btn btn-secondary" onclick="cancelSubtask()">Cancel</button>
                </div>
                
                <div style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.08);">
                    <div class="table-header">
                        <h2>📋 Detailed Project Plan</h2>
                        <div id="client-display">No client selected</div>
                    </div>
                    
                    <div style="padding: 15px; background: #f8f9fa;">
                        <button class="btn btn-primary" onclick="exportToCSV()">📊 Export to CSV</button>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 400px">Task</th>
                                <th style="width: 150px">Status</th>
                                <th style="width: 200px">Responsible</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody id="project-body"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Supabase SDK -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <script>
        // SUPABASE CONFIGURATION - UPDATE THESE VALUES
        const SUPABASE_URL = 'https://swlnojbzlfosjdtqswjd.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN3bG5vamJ6bGZvc2pkdHFzd2pkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTczNDUzNzIsImV4cCI6MjA3MjkyMTM3Mn0.weAmKGGMeUaerNwyAoz6dpFufK0Fz1YbrdaUzsKiYk8';
        
        // Initialize Supabase (optional - uncomment to enable)
        // const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Global data
        let clientData = { name: '', scaleupPM: '', clientPM: '', notes: '', logo: null };
        let teamMembers = [];
        let currentTaskForSubtask = '';
        let projectData = [
            {
                phase: "Phase 1: Analysis & Planning",
                tasks: [
                    {name: "1.1 Requirements Analysis", status: "not-started", responsible: "Scaleup Finance", description: "Map dimension requirements", subtasks: []},
                    {name: "1.2 System Mapping", status: "not-started", responsible: "Client", description: "Current setup in all systems", subtasks: []},
                    {name: "1.3 Gap Analysis", status: "not-started", responsible: "Scaleup Finance", description: "Identify changes", subtasks: []},
                    {name: "1.4 Technical Architecture", status: "not-started", responsible: "Scaleup Finance", description: "Design solution", subtasks: []}
                ]
            },
            {
                phase: "Phase 2: e-conomic Configuration",
                tasks: [
                    {name: "2.1 Dimension Setup", status: "not-started", responsible: "Scaleup Finance", description: "Create dimensions", subtasks: []},
                    {name: "2.2 Chart of Accounts", status: "not-started", responsible: "Scaleup Finance", description: "Update accounts", subtasks: []},
                    {name: "2.3 Report Configuration", status: "not-started", responsible: "Scaleup Finance", description: "Customize reports", subtasks: []},
                    {name: "2.4 User Permissions", status: "not-started", responsible: "Client", description: "Setup access", subtasks: []}
                ]
            },
            {
                phase: "Phase 3: Integrations",
                tasks: [
                    {name: "3.1 Corpay Setup", status: "not-started", responsible: "Client", description: "Configure Corpay", subtasks: []},
                    {name: "3.2 Pleo Setup", status: "not-started", responsible: "Client", description: "Configure Pleo", subtasks: []},
                    {name: "3.3 Integration Testing", status: "not-started", responsible: "Scaleup Finance", description: "Test integrations", subtasks: []},
                    {name: "3.4 Data Validation", status: "not-started", responsible: "Scaleup Finance", description: "Verify data flow", subtasks: []}
                ]
            },
            {
                phase: "Phase 4: Go-Live",
                tasks: [
                    {name: "4.1 User Training", status: "not-started", responsible: "Scaleup Finance", description: "Train users", subtasks: []},
                    {name: "4.2 Documentation", status: "not-started", responsible: "Scaleup Finance", description: "Create manuals", subtasks: []},
                    {name: "4.3 Production Deploy", status: "not-started", responsible: "Scaleup Finance", description: "Go live", subtasks: []},
                    {name: "4.4 Support", status: "not-started", responsible: "Scaleup Finance", description: "Post go-live support", subtasks: []}
                ]
            }
        ];

        // Logo Upload Handler
        function handleLogoUpload(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    // Update preview
                    document.getElementById('preview-image').src = e.target.result;
                    document.getElementById('logo-preview').style.display = 'block';
                    
                    // Update header logo
                    const headerLogo = document.getElementById('header-logo');
                    headerLogo.src = e.target.result;
                    headerLogo.style.display = 'block';
                    document.getElementById('logo-fallback').style.display = 'none';
                    
                    // Store in clientData
                    clientData.logo = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        // Team member functions
        function addTeamMember() {
            const name = document.getElementById('new-member-name').value.trim();
            const company = document.getElementById('new-member-company').value;
            
            if (!name) {
                alert('Please enter team member name');
                return;
            }
            
            teamMembers.push({ name, company });
            document.getElementById('new-member-name').value = '';
            updateTeamMembersList();
        }

        function updateTeamMembersList() {
            const listDiv = document.getElementById('team-members-list');
            
            if (teamMembers.length === 0) {
                listDiv.innerHTML = '<p style="color: #666; font-style: italic; text-align: center; padding: 20px;">No team members added yet</p>';
                return;
            }
            
            listDiv.innerHTML = teamMembers.map((member, index) => `
                <div class="team-member-item">
                    <div>
                        <strong>${member.name}</strong> - ${member.company}
                    </div>
                    <button class="btn btn-danger" onclick="removeTeamMember(${index})">Remove</button>
                </div>
            `).join('');
        }

        function removeTeamMember(index) {
            teamMembers.splice(index, 1);
            updateTeamMembersList();
        }

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
            checkSetup();
        }

        // Fill test data
        function fillTestData() {
            document.getElementById('client-name').value = 'ABC Corporation';
            document.getElementById('scaleup-pm').value = 'Lars Jensen';
            document.getElementById('client-pm').value = 'John Smith (CFO)';
            document.getElementById('project-notes').value = 'Standard e-conomic implementation with Corpay and Pleo.';
            
            teamMembers = [
                { name: 'Lars Jensen', company: 'Scaleup Finance' },
                { name: 'Maria Petersen', company: 'Scaleup Finance' },
                { name: 'John Smith', company: 'Client' },
                { name: 'Sarah Johnson', company: 'Client' }
            ];
            updateTeamMembersList();
        }

        // Save setup
        function saveSetup() {
            clientData.name = document.getElementById('client-name').value.trim();
            clientData.scaleupPM = document.getElementById('scaleup-pm').value.trim();
            clientData.clientPM = document.getElementById('client-pm').value.trim();
            clientData.notes = document.getElementById('project-notes').value.trim();
            
            if (!clientData.name || !clientData.scaleupPM) {
                alert('Please fill in required fields');
                return;
            }
            
            // Update task responsibilities with client name
            projectData.forEach(phase => {
                phase.tasks.forEach(task => {
                    if (task.responsible === 'Client') {
                        task.responsible = clientData.name;
                    }
                });
            });
            
            switchTab('dashboard');
            document.querySelectorAll('.nav-tab')[1].click();
        }

        // Check setup
        function checkSetup() {
            const hasSetup = clientData.name && clientData.scaleupPM;
            
            const dashboardWarning = document.getElementById('dashboard-warning');
            const dashboardContent = document.getElementById('dashboard-content');
            const projectWarning = document.getElementById('project-warning');
            const projectContent = document.getElementById('project-content');
            
            if (hasSetup) {
                if (dashboardWarning) dashboardWarning.style.display = 'none';
                if (dashboardContent) dashboardContent.style.display = 'block';
                if (projectWarning) projectWarning.style.display = 'none';
                if (projectContent) projectContent.style.display = 'block';
                
                document.getElementById('client-display').textContent = `${clientData.name} | PM: ${clientData.scaleupPM}`;
                
                populateTable();
                updateDashboard();
                updateTeamTaskDistribution();
            } else {
                if (dashboardWarning) dashboardWarning.style.display = 'block';
                if (dashboardContent) dashboardContent.style.display = 'none';
                if (projectWarning) projectWarning.style.display = 'block';
                if (projectContent) projectContent.style.display = 'none';
            }
        }

        // Populate table
        function populateTable() {
            const tbody = document.getElementById('project-body');
            tbody.innerHTML = '';
            
            const responsibleOptions = ['Scaleup Finance', clientData.name || 'Client'];
            teamMembers.forEach(m => responsibleOptions.push(m.name));
            
            projectData.forEach(phase => {
                // Phase header
                const phaseRow = document.createElement('tr');
                phaseRow.innerHTML = `<td colspan="4" style="background: #3a4a47; color: white; font-weight: bold; padding: 15px;">${phase.phase}</td>`;
                tbody.appendChild(phaseRow);
                
                // Tasks
                phase.tasks.forEach(task => {
                    const taskRow = document.createElement('tr');
                    
                    const responsibleDropdown = responsibleOptions.map(option => 
                        `<option value="${option}" ${task.responsible === option ? 'selected' : ''}>${option}</option>`
                    ).join('');
                    
                    taskRow.innerHTML = `
                        <td>
                            <div class="task-cell">
                                <span class="task-name">${task.name}</span>
                                <button class="add-subtask-btn" onclick="showSubtaskInput('${task.name}')">
                                    ➕ Add Subtask
                                </button>
                            </div>
                        </td>
                        <td>
                            <select class="status-select status-${task.status}" onchange="updateTaskStatus('${task.name}', this.value)">
                                <option value="not-started" ${task.status === 'not-started' ? 'selected' : ''}>⏳ Not Started</option>
                                <option value="in-progress" ${task.status === 'in-progress' ? 'selected' : ''}>🔄 In Progress</option>
                                <option value="completed" ${task.status === 'completed' ? 'selected' : ''}>✅ Completed</option>
                            </select>
                        </td>
                        <td>
                            <select style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px;" onchange="updateTaskResponsible('${task.name}', this.value)">
                                ${responsibleDropdown}
                            </select>
                        </td>
                        <td>${task.description}</td>
                    `;
                    tbody.appendChild(taskRow);
                    
                    // Subtasks
                    if (task.subtasks && task.subtasks.length > 0) {
                        task.subtasks.forEach((subtask, index) => {
                            const subtaskRow = document.createElement('tr');
                            subtaskRow.className = 'subtask-row';
                            
                            const subtaskResponsibleDropdown = responsibleOptions.map(option => 
                                `<option value="${option}" ${subtask.responsible === option ? 'selected' : ''}>${option}</option>`
                            ).join('');
                            
                            subtaskRow.innerHTML = `
                                <td>
                                    <span style="color: #666;">└─</span> ${subtask.name}
                                    <button onclick="removeSubtask('${task.name}', ${index})" style="background: #dc3545; color: white; border: none; padding: 2px 6px; border-radius: 3px; font-size: 0.7em; margin-left: 10px;">🗑️</button>
                                </td>
                                <td>
                                    <select class="status-select status-${subtask.status}" onchange="updateSubtaskStatus('${task.name}', ${index}, this.value)">
                                        <option value="not-started" ${subtask.status === 'not-started' ? 'selected' : ''}>⏳ Not Started</option>
                                        <option value="in-progress" ${subtask.status === 'in-progress' ? 'selected' : ''}>🔄 In Progress</option>
                                        <option value="completed" ${subtask.status === 'completed' ? 'selected' : ''}>✅ Completed</option>
                                    </select>
                                </td>
                                <td>
                                    <select onchange="updateSubtaskResponsible('${task.name}', ${index}, this.value)">
                                        ${subtaskResponsibleDropdown}
                                    </select>
                                </td>
                                <td>${subtask.description}</td>
                            `;
                            tbody.appendChild(subtaskRow);
                        });
                    }
                });
            });
        }

        // Subtask functions
        function showSubtaskInput(taskName) {
            currentTaskForSubtask = taskName;
            document.getElementById('target-task').textContent = taskName;
            document.getElementById('subtask-name').value = '';
            document.getElementById('subtask-desc').value = '';
            document.getElementById('subtask-input-area').style.display = 'block';
            document.getElementById('subtask-name').focus();
        }

        function cancelSubtask() {
            document.getElementById('subtask-input-area').style.display = 'none';
            currentTaskForSubtask = '';
        }

        function createSubtask() {
            const name = document.getElementById('subtask-name').value.trim();
            const desc = document.getElementById('subtask-desc').value.trim();
            
            if (!name) {
                alert('Please enter subtask name');
                return;
            }
            
            for (let phase of projectData) {
                for (let task of phase.tasks) {
                    if (task.name === currentTaskForSubtask) {
                        if (!task.subtasks) task.subtasks = [];
                        
                        const taskNumber = task.name.split(' ')[0];
                        const subtaskNumber = task.subtasks.length + 1;
                        const fullSubtaskNumber = `${taskNumber}.${subtaskNumber}`;
                        
                        task.subtasks.push({
                            name: `${fullSubtaskNumber} ${name}`,
                            status: 'not-started',
                            responsible: task.responsible,
                            description: desc || 'Subtask'
                        });
                        break;
                    }
                }
            }
            
            cancelSubtask();
            populateTable();
            updateDashboard();
            updateTeamTaskDistribution();
        }

        function removeSubtask(taskName, index) {
            if (confirm('Remove this subtask?')) {
                for (let phase of projectData) {
                    for (let task of phase.tasks) {
                        if (task.name === taskName && task.subtasks) {
                            task.subtasks.splice(index, 1);
                            break;
                        }
                    }
                }
                populateTable();
                updateDashboard();
                updateTeamTaskDistribution();
            }
        }

        // Update functions
        function updateTaskStatus(taskName, status) {
            for (let phase of projectData) {
                for (let task of phase.tasks) {
                    if (task.name === taskName) {
                        task.status = status;
                        event.target.className = `status-select status-${status}`;
                        updateDashboard();
                        updateTeamTaskDistribution();
                        break;
                    }
                }
            }
        }

        function updateSubtaskStatus(taskName, subtaskIndex, status) {
            for (let phase of projectData) {
                for (let task of phase.tasks) {
                    if (task.name === taskName && task.subtasks && task.subtasks[subtaskIndex]) {
                        task.subtasks[subtaskIndex].status = status;
                        event.target.className = `status-select status-${status}`;
                        updateDashboard();
                        updateTeamTaskDistribution();
                        break;
                    }
                }
            }
        }

        function updateTaskResponsible(taskName, newResponsible) {
            for (let phase of projectData) {
                for (let task of phase.tasks) {
                    if (task.name === taskName) {
                        task.responsible = newResponsible;
                        updateDashboard();
                        updateTeamTaskDistribution();
                        break;
                    }
                }
            }
        }

        function updateSubtaskResponsible(taskName, subtaskIndex, newResponsible) {
            for (let phase of projectData) {
                for (let task of phase.tasks) {
                    if (task.name === taskName && task.subtasks && task.subtasks[subtaskIndex]) {
                        task.subtasks[subtaskIndex].responsible = newResponsible;
                        updateDashboard();
                        updateTeamTaskDistribution();
                        break;
                    }
                }
            }
        }

        // Update dashboard
        function updateDashboard() {
            let totalTasks = 0;
            let completedTasks = 0;
            let ongoingTasks = 0;
            
            projectData.forEach(phase => {
                phase.tasks.forEach(task => {
                    totalTasks++;
                    if (task.status === 'completed') completedTasks++;
                    if (task.status === 'in-progress') ongoingTasks++;
                    
                    if (task.subtasks) {
                        task.subtasks.forEach(subtask => {
                            totalTasks++;
                            if (subtask.status === 'completed') completedTasks++;
                            if (subtask.status === 'in-progress') ongoingTasks++;
                        });
                    }
                });
            });
            
            const progressPercent = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            
            document.getElementById('overall-progress').textContent = progressPercent + '%';
            document.getElementById('overall-progress-bar').style.width = progressPercent + '%';
            document.getElementById('completed-tasks').textContent = completedTasks;
            document.getElementById('total-tasks').textContent = totalTasks;
            document.getElementById('ongoing-tasks').textContent = ongoingTasks;
            
            // Find next milestone
            let nextMilestone = 'All completed';
            for (const phase of projectData) {
                for (const task of phase.tasks) {
                    if (task.status !== 'completed') {
                        nextMilestone = task.name.split(' ').slice(1).join(' ');
                        break;
                    }
                }
                if (nextMilestone !== 'All completed') break;
            }
            document.getElementById('next-milestone').textContent = nextMilestone;
        }

        // Update team task distribution
        function updateTeamTaskDistribution() {
            const tasksByResponsible = {};
            
            projectData.forEach(phase => {
                phase.tasks.forEach(task => {
                    if (!tasksByResponsible[task.responsible]) {
                        tasksByResponsible[task.responsible] = {
                            total: 0,
                            completed: 0,
                            'in-progress': 0,
                            'not-started': 0
                        };
                    }
                    tasksByResponsible[task.responsible].total++;
                    tasksByResponsible[task.responsible][task.status]++;
                    
                    if (task.subtasks) {
                        task.subtasks.forEach(subtask => {
                            if (!tasksByResponsible[subtask.responsible]) {
                                tasksByResponsible[subtask.responsible] = {
                                    total: 0,
                                    completed: 0,
                                    'in-progress': 0,
                                    'not-started': 0
                                };
                            }
                            tasksByResponsible[subtask.responsible].total++;
                            tasksByResponsible[subtask.responsible][subtask.status]++;
                        });
                    }
                });
            });
            
            const container = document.getElementById('team-task-distribution');
            if (!container) return;
            
            container.innerHTML = '';
            
            Object.keys(tasksByResponsible).forEach(responsible => {
                const data = tasksByResponsible[responsible];
                const row = document.createElement('div');
                row.className = 'person-task-row';
                row.innerHTML = `
                    <div class="person-name">👤 ${responsible}</div>
                    <div class="task-counts">
                        <span class="task-count count-completed">✅ ${data.completed} done</span>
                        <span class="task-count count-progress">🔄 ${data['in-progress']} active</span>
                        <span class="task-count count-total">📋 ${data.total} total</span>
                    </div>
                `;
                container.appendChild(row);
            });
        }

        // Export to CSV
        function exportToCSV() {
            let csv = 'Phase,Task,Subtask,Status,Responsible,Description\n';
            
            projectData.forEach(phase => {
                phase.tasks.forEach(task => {
                    const status = task.status.replace('-', ' ');
                    csv += `"${phase.phase}","${task.name}","","${status}","${task.responsible}","${task.description}"\n`;
                    
                    if (task.subtasks) {
                        task.subtasks.forEach(subtask => {
                            const subStatus = subtask.status.replace('-', ' ');
                            csv += `"${phase.phase}","${task.name}","${subtask.name}","${subStatus}","${subtask.responsible}","${subtask.description}"\n`;
                        });
                    }
                });
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `scaleup_project_${clientData.name || 'export'}_${new Date().toISOString().slice(0,10)}.csv`;
            a.click();
        }

        // Auth functions (demo mode)
        function handleLogin() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('main-dashboard').style.display = 'block';
        }

        function handleLogout() {
            document.getElementById('login-screen').style.display = 'flex';
            document.getElementById('main-dashboard').style.display = 'none';
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Start with main dashboard visible (demo mode)
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('main-dashboard').style.display = 'block';
        });
    </script>
</body>
</html>